<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Reports - NDMRS</title>
    <link rel="stylesheet" href="css/userDashboard.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-dark text-white p-3" id="sidebar">
        <h2 class="text-center">NDMRS</h2>
        <ul class="list-unstyled">
            <li><a href="userDashboard.html" class="text-white"><i class="fas fa-home"></i> Dashboard</a></li>
            <li><a href="report.html" class="text-white"><i class="fas fa-exclamation-triangle"></i> Report Disaster</a></li>
            <li><a href="myReports.html" class="text-white active"><i class="fas fa-file-alt"></i> My Reports</a></li>
            <li><a href="profile.html" class="text-white"><i class="fas fa-user"></i> Profile</a></li>
            <li><a href="volunteer.html" class="text-white"><i class="fas fa-user"></i> Volunteer</a></li>
            <li><a href="signIn.html" class="text-white"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div id="page-content" class="p-4">
        <h2>📑 My Reports</h2>
        <div class="table-responsive mt-4">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Contact</th>
                    <th>Location</th>
                    <th>Created At</th>
                </tr>
                </thead>
                <tbody id="reports-table">
                <!-- Reports will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const accessToken = localStorage.getItem("accessToken");

        if (!accessToken) {
            alert("⚠️ Please login first.");
            window.location.href = "signIn.html";
            return;
        }

        fetch("http://localhost:8080/auth/reports/my", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${accessToken}`,
                "Content-Type": "application/json"
            }
        })
            .then(res => res.json())
            .then(result => {
                if (result.status === 200) {
                    const reports = result.data;
                    const tableBody = document.getElementById("reports-table");
                    tableBody.innerHTML = "";

                    if (reports.length === 0) {
                        tableBody.innerHTML = `<tr><td colspan="6" class="text-center">No reports found</td></tr>`;
                    } else {
                        reports.forEach(r => {
                            const row = `
                                <tr>
                                    <td>${r.id}</td>
                                    <td>${r.type}</td>
                                    <td>${r.description}</td>
                                    <td>${r.reporterContact || "-"}</td>
                                    <td>${r.latitude}, ${r.longitude}</td>
                                    <td>${new Date(r.createdAt).toLocaleString()}</td>
                                </tr>
                            `;
                            tableBody.innerHTML += row;
                        });
                    }
                } else {
                    alert("❌ Failed to load reports: " + result.message);
                }
            })
            .catch(err => {
                console.error("Error fetching reports:", err);
                alert("🚨 Server error while loading reports.");
            });

        // Logout
        const logoutLink = document.querySelector('a[href="signIn.html"]');
        logoutLink.addEventListener("click", (e) => {
            e.preventDefault();
            localStorage.clear();
            window.location.href = "signIn.html";
        });
    });
</script>

</body>
</html>
