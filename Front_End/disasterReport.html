<!DOCTYPE html>
<html>
<head>
    <title>Disaster Location Marker</title>
    <style>
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>
<h2>Report a Disaster Location</h2>
<p>Click on the map to mark the disaster location.</p>

<label for="disasterType">Select Disaster Type: </label>
<select id="disasterType">
    <option value="Flood">ğŸŒŠ Flood</option>
    <option value="Landslide">â›° Landslide</option>
    <option value="Earthquake">ğŸŒ Earthquake</option>
    <option value="Cyclone">ğŸŒª Cyclone</option>
</select>

<div id="map"></div>

<script>
    let map;

    // marker colors by disaster type
    const disasterIcons = {
        "Flood": "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
        "Landslide": "http://maps.google.com/mapfiles/ms/icons/brown-dot.png",
        "Earthquake": "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
        "Cyclone": "http://maps.google.com/mapfiles/ms/icons/green-dot.png"
    };

    function initMap() {
        const sriLanka = { lat: 7.8731, lng: 80.7718 };

        map = new google.maps.Map(document.getElementById("map"), {
            center: sriLanka,
            zoom: 7,
        });

        // load saved disaster reports
        loadSavedReports();

        // user clicks on map
        map.addListener("click", (event) => {
            let type = document.getElementById("disasterType").value;
            placeMarker(event.latLng, type);
            sendLocation(event.latLng.lat(), event.latLng.lng(), type);
        });
    }

    function placeMarker(location, type) {
        new google.maps.Marker({
            position: location,
            map: map,
            icon: disasterIcons[type] || null
        });
    }

    function sendLocation(lat, lng, type) {
        fetch("http://localhost:8080/auth/disasters/report", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ latitude: lat, longitude: lng, type: type })
        })
            .then(response => response.json())
            .then(data => {
                alert("Disaster Report Saved! ID: " + data.id);
            })
            .catch(error => console.error("Error:", error));
    }

    function loadSavedReports() {
        fetch("http://localhost:8080/auth/disasters/all")
            .then(response => response.json())
            .then(reports => {
                reports.forEach(report => {
                    new google.maps.Marker({
                        position: { lat: report.latitude, lng: report.longitude },
                        map: map,
                        icon: disasterIcons[report.type] || null
                    });
                });
            })
            .catch(error => console.error("Error loading reports:", error));
    }
</script>

<!-- Google Maps API -->
<script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUWcB1lsDF4RfM3H-e2WRtxwqNObzZ6Uo
&callback=initMap">
</script>
</body>
</html>
