<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard - Disaster Management</title>
    <link rel="stylesheet" href="css/admin.css">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<!-- Sidebar -->
<div class="sidebar">
    <h2>Admin Panel</h2>
    <a href="#" class="active" onclick="showPage('dashboard')">Dashboard</a>
    <a href="#" onclick="showPage('employees')">Employees</a>
    <a href="#" onclick="showPage('volunteers')">Volunteers</a>
    <a href="#" onclick="showPage('donors')">Donors</a>
</div>

<!-- Main Content -->
<div class="main-content">
    <div class="topbar">
        <h1 id="pageTitle">Dashboard</h1>
        <span>👤 Admin</span>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard" class="page active">
        <div class="stats-grid">
            <div class="stat-card">
                <h2 id="statEmployees">0</h2>
                <p>Employees</p>
            </div>
            <div class="stat-card">
                <h2 id="statVolunteers">0</h2>
                <p>Volunteers</p>
            </div>
            <div class="stat-card">
                <h2 id="statDonors">0</h2>
                <p>Donors</p>
            </div>
            <div class="stat-card">
                <h2 id="statDonations">$0</h2>
                <p>Total Donations</p>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-card">
            <canvas id="dashboardChart"></canvas>
        </div>
    </div>

    <!-- Employees Page -->
    <div id="employees" class="page">
        <div class="card">
            <h3>Add Employee</h3>
            <form id="addEmployeeForm">
                <div class="form-group"><label>Name</label><input type="text" id="empName" required></div>
                <div class="form-group"><label>Email</label><input type="email" id="empEmail" required></div>
                <div class="form-group"><label>Position</label><input type="text" id="empPosition" required></div>
                <button type="submit">Add Employee</button>
            </form>
        </div>
        <div class="card">
            <h3>Employee List</h3>
            <div class="card-container" id="employeeList"></div>
        </div>
    </div>

    <!-- Volunteers Page -->
    <div id="volunteers" class="page">
        <div class="card">
            <h3>Add Volunteer</h3>
            <form id="addVolunteerForm">
                <div class="form-group"><label>Name</label><input type="text" id="volName" required></div>
                <div class="form-group"><label>Email</label><input type="email" id="volEmail" required></div>
                <div class="form-group"><label>Phone</label><input type="text" id="volPhone" required></div>
                <div class="form-group"><label>Skills</label><input type="text" id="volSkills"></div>
                <button type="submit">Add Volunteer</button>
            </form>
        </div>

        <div class="card">
            <h3>Volunteer List</h3>
            <input type="text" id="volunteerSearch" placeholder="Search volunteers..." onkeyup="filterVolunteers()" class="search-bar">
            <div class="card-container" id="volunteerList"></div>
        </div>
    </div>

    <!-- Donors Page -->
    <div id="donors" class="page">
        <div class="card">
            <h3>Add Donor</h3>
            <form id="addDonorForm">
                <div class="form-group"><label>Name</label><input type="text" id="donName" required></div>
                <div class="form-group"><label>Email</label><input type="email" id="donEmail" required></div>
                <div class="form-group"><label>Donation Amount</label><input type="number" id="donAmount" required></div>
                <button type="submit">Add Donor</button>
            </form>
        </div>
        <div class="card">
            <h3>Donor List</h3>
            <div class="card-container" id="donorList"></div>
        </div>
    </div>
</div>

<!-- Popup Modal -->
<div id="popupModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">Edit</h2>
        <form id="updateForm"></form>
    </div>
</div>

<script src="js/admin.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {

        // 🔹 Fetch Employees count
        fetch("http://localhost:8080/auth/employees/count")
            .then(res => res.json())
            .then(data => {
                document.getElementById("statEmployees").textContent = data.data;
            });

        // 🔹 Fetch Volunteers count
        fetch("http://localhost:8080/auth/volunteers/count")
            .then(res => res.json())
            .then(data => {
                document.getElementById("statVolunteers").textContent = data.data;
            });

        // 🔹 Fetch Donors count
        fetch("http://localhost:8080/auth/donors/count")
            .then(res => res.json())
            .then(data => {
                document.getElementById("statDonors").textContent = data.data;
            });

        // 🔹 Donations amount (ඇත්තටම DB එකේ තියෙනවා නම් backend එකෙන් API එකක් හදන්න)
        fetch("http://localhost:8080/auth/donations/total")
            .then(res => res.json())
            .then(data => {
                document.getElementById("statDonations").textContent = "$" + data.data;
            });

        fetch("http://localhost:8080/auth/donations/monthly")
            .then(res => res.json())
            .then(data => {
                const months = Object.keys(data.data);
                const amounts = Object.values(data.data);

                const ctx = document.getElementById("dashboardChart").getContext("2d");
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: 'Donations',
                            data: amounts,
                            borderColor: '#ff3d67',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {legend: {display: false}}
                    }
                });
            });
    });
</script>

</body>
</html>
